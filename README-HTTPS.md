# Настройка HTTPS (порт 443)

## Текущее состояние

- **Порт 443** пробрасывается в `docker-compose.yml` ✅
- **HTTPS блок** в `nginx.conf` **закомментирован** по умолчанию (для безопасной работы без сертификатов)
- Nginx запускается и работает на порту 80 (HTTP) ✅

## Активация HTTPS

### Шаг 1: Получение SSL сертификата

```bash
./setup-ssl.sh
```

Этот скрипт:
- Получит SSL сертификат от Let's Encrypt
- Автоматически активирует HTTPS блок в `nginx.conf`
- Перезапустит Nginx

### Шаг 2: Проверка активации

После выполнения `setup-ssl.sh` HTTPS должен быть автоматически активирован. Проверьте:

```bash
# Проверка, что HTTPS блок активен
grep "listen 443 ssl" nginx.conf

# Проверка синтаксиса
docker-compose exec nginx nginx -t

# Проверка статуса
docker-compose ps nginx
```

### Шаг 3: Ручная активация (если нужно)

Если автоматическая активация не сработала:

```bash
./enable-https-safe.sh
```

Или вручную:
1. Откройте `nginx.conf`
2. Найдите закомментированный HTTPS блок (строки ~202-347)
3. Раскомментируйте все строки (удалите `#` в начале)
4. Проверьте синтаксис: `docker-compose exec nginx nginx -t`
5. Перезапустите: `docker-compose restart nginx`

## Важные моменты

1. **Без сертификатов**: Nginx не запустится, если HTTPS блок активен, но сертификатов нет
2. **С сертификатами**: После получения сертификатов через `setup-ssl.sh` HTTPS активируется автоматически
3. **Порт 443**: Всегда пробрасывается в `docker-compose.yml`, но работает только если HTTPS блок активен

## Проверка работы HTTPS

```bash
# Проверка порта 443
curl -I https://zelyonkin.ru

# Проверка SSL сертификата
openssl s_client -connect zelyonkin.ru:443 -servername zelyonkin.ru
```

## Решение проблем

### Nginx не запускается после активации HTTPS

**Причина**: Сертификаты не найдены

**Решение**:
1. Проверьте наличие сертификатов: `ls -la certbot/live/zelyonkin.ru/`
2. Если сертификатов нет, получите их: `./setup-ssl.sh`
3. Если нужно временно отключить HTTPS, закомментируйте HTTPS блок в `nginx.conf`

### Порт 443 не отвечает

**Причина**: HTTPS блок не активирован

**Решение**:
1. Проверьте, что HTTPS блок активен: `grep "listen 443" nginx.conf`
2. Если блок закомментирован, активируйте его: `./enable-https-safe.sh`
3. Перезапустите Nginx: `docker-compose restart nginx`

### Ошибка "SSL certificate not found"

**Причина**: Путь к сертификатам неправильный или сертификаты не существуют

**Решение**:
1. Проверьте путь в `nginx.conf`: должен быть `/etc/letsencrypt/live/zelyonkin.ru/fullchain.pem`
2. Проверьте, что сертификаты существуют: `ls -la certbot/live/zelyonkin.ru/`
3. Если сертификатов нет, получите их: `./setup-ssl.sh`

