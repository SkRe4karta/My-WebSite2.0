# Changelog

Все значимые изменения в проекте документируются в этом файле.

Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/),
и проект придерживается [Semantic Versioning](https://semver.org/lang/ru/).

## [2.2.1] - 2025-01-18

### Добавлено
- **Управление пользователями:** Полный CRUD интерфейс в настройках админки
- **API для пользователей:** `/api/users` (GET, POST) и `/api/users/[id]` (PUT, DELETE)
- **Диагностические скрипты:**
  - `npm run db:test-login` - тестирование входа
  - `npm run db:check-auth` - проверка настроек аутентификации
  - `npm run db:fix-user` - исправление пользователя
  - `npm run db:force-fix-user` - принудительное исправление с генерацией хеша
- **Автоматическое создание администратора:** После миграций БД
- **Компонент UserManagement:** UI для управления пользователями в настройках
- **Документация:** `DEPLOY-UPDATE.md` и `DIAGNOSE-LOGIN.md`

### Изменено
- **Аутентификация NextAuth:** 
  - Убрана привязка к одному пользователю (ADMIN_USERNAME)
  - Поддержка входа по email или name для всех пользователей
  - Убран PrismaAdapter при JWT strategy (исправлен конфликт)
  - Улучшена конфигурация сессий и cookies
- **Миграции БД:** Изменен `db:migrate` на `prisma migrate deploy` для продакшена
- **Инициализация администратора:** Правильное сохранение name (skre4karta)
- **Скрипты установки:** Автоматическое создание администратора после миграций

### Исправлено
- **Проблема с входом:** Исправлена логика поиска пользователя по email/name
- **Создание сессий:** Исправлен session callback для получения актуальных данных из БД
- **Миграции:** Улучшена обработка ошибок в install.sh и deploy.sh
- **Пароли:** Автоматическая миграция plain text паролей в bcrypt при входе

## [2.2.0] - 2025-01-XX

### Добавлено
- Функционал смены пароля в настройках админки
- API endpoint `/api/auth/change-password` для изменения пароля
- `.env.example` файл с примерами всех переменных окружения
- Пароль по умолчанию "1234" для релизной версии
- Полная документация для релиза (`RELEASE.md`)

### Изменено
- Переход на использование `ADMIN_PASSWORD_HASH` вместо `ADMIN_PASSWORD` во всех компонентах
- Обновлён `setup-env.sh` для генерации хеша пароля по умолчанию
- Все проверки пароля теперь используют хеш из БД через `verifyPassword()`
- Обновлена документация для релизной версии

### Исправлено
- Устранено несоответствие между `ADMIN_PASSWORD` и `ADMIN_PASSWORD_HASH`
- Исправлена проверка пароля в 2FA routes (теперь использует хеш из БД)
- Улучшена безопасность: пароли всегда хранятся в захешированном виде

## [2.1.0] - 2025-01-17

### Добавлено
- Единая система цветов с CSS переменными
- Система иконок (Icon component)
- Компоненты LoadingSpinner и Skeleton для loading states
- ErrorBoundary для обработки ошибок
- Унифицированная обработка ошибок (lib/errors.ts)
- Конфигурационные файлы (.editorconfig, .prettierrc)
- CHANGELOG.md для ведения истории изменений
- Улучшенная типографика с CSS переменными

### Изменено
- Обновлён README.md с полной документацией
- Реорганизована структура проекта (styles/globals.css перемещён в src/styles/)
- Улучшены loading states в компонентах
- Оптимизированы зависимости

### Удалено
- Лишние документационные файлы (AUTH_FIX.md, ENV_FIX.md, и др.)
- Неиспользуемые скрипты (check-env.js, create-env.js, reset-password.js, restart-server.ps1)
- Неиспользуемые SVG файлы из public/
- Дублирующиеся папки images/

### Исправлено
- Обновлён .gitignore для лучшего исключения файлов
- Настроены ESLint и Prettier

## [2.0.0] - 2025-01-16

### Добавлено
- Полностью переработанная админ-панель с серо-зелёной темой
- Drag & Drop виджетов на дашборде
- Двухфакторная аутентификация (2FA/TOTP)
- Хеширование паролей через bcrypt
- Защита от брутфорса с блокировкой IP
- Content Security Policy (CSP)
- Система аудита безопасности
- Глобальный поиск по всем модулям
- Кнопка перехода на личный сайт из админки

### Изменено
- Единая тема для всего сайта (без выбора темы)
- Улучшенный UI с плавными переходами и эффектами

## [1.0.0] - 2024-12-XX

### Добавлено
- Первоначальный релиз
- Публичная визитка (Hero, Projects, About, Contacts)
- Приватный кабинет (заметки, файлы, Vault, журнал)
- Базовая аутентификация
- Развертывание на Docker + Nginx

[2.2.1]: https://github.com/SkRe4karta/My_WebSite/compare/v2.2.0...v2.2.1
[2.2.0]: https://github.com/SkRe4karta/My_WebSite/compare/v2.1.0...v2.2.0
[2.1.0]: https://github.com/SkRe4karta/My_WebSite/compare/v2.0.0...v2.1.0
[2.0.0]: https://github.com/SkRe4karta/My_WebSite/compare/v1.0.0...v2.0.0
[1.0.0]: https://github.com/SkRe4karta/My_WebSite/releases/tag/v1.0.0

